<!DOCTYPE html>
<html lang="en">
<head>
<!-- Provenance: Planetary Restoration Archive | planetaryrestorationarchive.com -->
<!-- GitHub: github.com/therickyfoster | Steward: Foster + Navi -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Foster + Navi ¬∑ Planetary Restoration Archive">
<meta name="description" content="Real-time peace monitoring dashboard with conflict data, humanitarian alerts, and AI assistant">
<link rel="me" href="https://planetaryrestorationarchive.com">
<link rel="me" href="https://github.com/TheRickyFoster">
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiUGVhY2UgRGFzaGJvYXJkIiwic2hvcnRfbmFtZSI6IlBlYWNlIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzBhMGUxYSIsInRoZW1lX2NvbG9yIjoiIzJkNWYzZiJ9">
<title>Peace Dashboard ¬∑ Real-Time Monitoring</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--primary:#2d5f3f;--primary-light:#3a7a52;--accent:#7fb069;--bg:#0a0e1a;--surface:rgba(20,25,40,0.9);--surface-alt:rgba(30,35,50,0.85);--text:#e8f0f2;--text-secondary:#b8c5d0;--text-tertiary:#8896a4;--border:rgba(127,176,105,0.2);--shadow:rgba(0,0,0,0.5);--success:#16a34a;--warning:#f59e0b;--danger:#dc2626;--info:#3b82f6;--transition:200ms cubic-bezier(0.4,0,0.2,1)}
html{scroll-behavior:smooth;font-size:16px}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;overflow-x:hidden;position:relative}
#galaxy-canvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;background:linear-gradient(to bottom,#0a0e1a,#1a1e2e,#0a0e1a)}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
header{background:var(--surface);border-bottom:2px solid var(--primary);position:sticky;top:0;z-index:1000;box-shadow:0 2px 8px var(--shadow);backdrop-filter:blur(10px)}
.header-content{max-width:1600px;margin:0 auto;padding:1rem 1.5rem;display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap}
.logo{display:flex;align-items:center;gap:0.75rem;text-decoration:none;color:var(--text)}
.logo-icon{font-size:1.75rem}
.logo-text h1{font-size:1.25rem;font-weight:700;color:var(--primary);line-height:1.2}
.logo-text .subtitle{font-size:0.75rem;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.05em}
.header-actions{display:flex;gap:0.5rem;align-items:center}
.status-indicator{display:flex;align-items:center;gap:0.5rem;padding:0.5rem 1rem;background:var(--surface-alt);border-radius:6px;font-size:0.875rem}
.status-dot{width:8px;height:8px;border-radius:50%;background:var(--success);animation:pulse 2s infinite}
.status-offline{background:var(--danger)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
.btn{padding:0.5rem 1rem;border:none;border-radius:6px;background:var(--surface-alt);color:var(--text);cursor:pointer;font-size:0.875rem;font-weight:500;transition:all var(--transition);display:inline-flex;align-items:center;gap:0.5rem;text-decoration:none}
.btn:hover,.btn:focus{background:var(--primary);color:white;transform:translateY(-1px)}
.btn-primary{background:var(--primary);color:white}
.btn-primary:hover{background:var(--primary-light)}
main{max-width:1600px;margin:0 auto;padding:2rem 1.5rem}
.metrics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:2rem}
.metric-card{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-light) 100%);color:white;padding:1.5rem;border-radius:8px;box-shadow:0 2px 8px var(--shadow);transition:transform var(--transition);border:1px solid rgba(127,176,105,0.3)}
.metric-card:hover{transform:translateY(-4px)}
.metric-label{font-size:0.75rem;text-transform:uppercase;letter-spacing:0.05em;opacity:0.9;margin-bottom:0.5rem}
.metric-value{font-size:2rem;font-weight:700;line-height:1;margin-bottom:0.25rem}
.metric-change{font-size:0.875rem;opacity:0.9}
.card{background:var(--surface);border-radius:8px;padding:1.5rem;box-shadow:0 2px 8px var(--shadow);border:1px solid var(--border);transition:all var(--transition);backdrop-filter:blur(10px);margin-bottom:1.5rem}
.card:hover{box-shadow:0 4px 16px var(--shadow);transform:translateY(-2px)}
.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:0.75rem;border-bottom:1px solid var(--border)}
.card-title{font-size:1.125rem;font-weight:700;color:var(--primary);display:flex;align-items:center;gap:0.5rem}
.feed-container{display:grid;gap:1rem}
.feed-item{background:var(--surface);border-radius:8px;padding:1rem;border-left:4px solid var(--primary);transition:all var(--transition)}
.feed-item:hover{transform:translateX(4px);box-shadow:0 2px 8px var(--shadow)}
.feed-item-title{font-size:1rem;font-weight:600;margin-bottom:0.5rem}
.feed-item-meta{font-size:0.75rem;color:var(--text-tertiary);margin-top:0.5rem}
.peace-needle-gauge{background:var(--surface-alt);border-radius:12px;padding:2rem;border:1px solid var(--border)}
.needle-container{position:relative;width:100%;max-width:400px;margin:0 auto;height:200px}
.needle-scale{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:350px;height:4px;background:linear-gradient(to right,#dc2626,#f59e0b,#7fb069);border-radius:2px}
.needle-pointer{position:absolute;bottom:0;left:50%;width:4px;height:150px;background:var(--text);transform-origin:bottom center;transform:translateX(-50%) rotate(-90deg);transition:transform 1s cubic-bezier(0.4,0,0.2,1);border-radius:2px 2px 0 0}
.needle-pointer::before{content:'';position:absolute;top:-8px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:12px solid var(--text)}
.needle-center{position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);width:20px;height:20px;background:var(--primary);border-radius:50%;border:3px solid var(--text)}
.needle-labels{display:flex;justify-content:space-between;margin-top:0.5rem;padding:0 2rem}
.needle-label{font-size:0.875rem;font-weight:600}
.needle-label.collapse{color:var(--danger)}
.needle-label.peace{color:var(--success)}
.needle-score{text-align:center;margin-top:1rem;font-size:1.5rem;font-weight:700;color:var(--primary)}
.chat-widget{position:fixed;bottom:20px;right:20px;z-index:2000;width:400px;max-width:calc(100vw - 40px)}
.chat-toggle{background:var(--primary);color:white;border:none;padding:1rem;border-radius:50%;cursor:pointer;font-size:1.5rem;box-shadow:0 4px 16px var(--shadow);transition:all var(--transition);width:60px;height:60px;display:flex;align-items:center;justify-content:center}
.chat-toggle:hover{background:var(--primary-light);transform:scale(1.1)}
.chat-container{display:none;background:var(--surface);border-radius:12px;box-shadow:0 8px 32px var(--shadow);border:2px solid var(--primary);overflow:hidden}
.chat-container.active{display:flex;flex-direction:column;height:500px}
.chat-header{padding:1rem;background:var(--primary);color:white;display:flex;justify-content:space-between;align-items:center}
.chat-close{background:none;border:none;color:white;font-size:1.5rem;cursor:pointer;padding:0;line-height:1}
.chat-messages{flex:1;overflow-y:auto;padding:1rem;display:flex;flex-direction:column;gap:1rem}
.chat-message{padding:0.75rem 1rem;border-radius:8px;max-width:85%}
.chat-message.user{background:var(--primary);color:white;align-self:flex-end}
.chat-message.bot{background:var(--surface-alt);align-self:flex-start}
.chat-input-container{padding:1rem;border-top:1px solid var(--border);display:flex;gap:0.5rem}
.chat-input{flex:1;padding:0.75rem;border:2px solid var(--border);border-radius:6px;background:var(--surface-alt);color:var(--text);font-size:1rem}
.chat-input:focus{outline:none;border-color:var(--primary)}
.chat-send{background:var(--primary);color:white;border:none;padding:0.75rem 1.5rem;border-radius:6px;cursor:pointer;font-weight:600}
.chat-send:hover{background:var(--primary-light)}
.loading{display:inline-block;width:16px;height:16px;border:3px solid var(--border);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.lang-selector{padding:0.5rem;background:var(--surface-alt);border-radius:6px;border:1px solid var(--border);color:var(--text);font-size:0.875rem;cursor:pointer}
.alert{padding:1rem;border-radius:8px;margin-bottom:1rem;border-left:4px solid;display:flex;align-items:start;gap:1rem;background:var(--surface)}
.alert-info{border-color:var(--info);color:var(--info)}
.alert-success{border-color:var(--success);color:var(--success)}
.alert-warning{border-color:var(--warning);color:var(--warning)}
.alert-danger{border-color:var(--danger);color:var(--danger)}
@media(max-width:768px){.header-content{flex-direction:column}.metrics-grid{grid-template-columns:repeat(2,1fr)}.chat-widget{width:calc(100vw - 40px)}.chat-container.active{height:400px}}
</style>
</head>
<body>
<canvas id="galaxy-canvas"></canvas>

<header role="banner">
<div class="header-content">
<a href="#" class="logo">
<span class="logo-icon">üåç</span>
<div class="logo-text">
<h1>Peace Dashboard</h1>
<div class="subtitle">Real-Time Global Monitoring</div>
</div>
</a>
<div class="header-actions">
<div class="status-indicator">
<span class="status-dot" id="connection-status"></span>
<span id="connection-text">Online</span>
</div>
<select class="lang-selector" id="lang-select">
<option value="en">English</option>
<option value="es">Espa√±ol</option>
<option value="fr">Fran√ßais</option>
<option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
<option value="ru">–†—É—Å—Å–∫–∏–π</option>
<option value="zh">‰∏≠Êñá</option>
<option value="pt">Portugu√™s</option>
<option value="de">Deutsch</option>
<option value="ja">Êó•Êú¨Ë™û</option>
<option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
</select>
<button class="btn btn-primary" id="refresh-all">
<span>üîÑ</span> <span data-i18n="refresh">Refresh</span>
</button>
</div>
</div>
</header>

<main role="main">
<div class="metrics-grid">
<div class="metric-card" style="background:linear-gradient(135deg,#dc2626 0%,#ef4444 100%)">
<div class="metric-label" data-i18n="conflicts">Active Conflicts</div>
<div class="metric-value" id="metric-conflicts">...</div>
<div class="metric-change" id="conflict-trend">Loading...</div>
</div>
<div class="metric-card" style="background:linear-gradient(135deg,#16a34a 0%,#22c55e 100%)">
<div class="metric-label" data-i18n="humanitarian">Humanitarian Ops</div>
<div class="metric-value" id="metric-humanitarian">...</div>
<div class="metric-change" id="humanitarian-trend">Loading...</div>
</div>
<div class="metric-card" style="background:linear-gradient(135deg,#f59e0b 0%,#fbbf24 100%)">
<div class="metric-label" data-i18n="displaced">Displacement Events</div>
<div class="metric-value" id="metric-displaced">...</div>
<div class="metric-change" id="displaced-trend">Loading...</div>
</div>
<div class="metric-card" style="background:linear-gradient(135deg,#7fb069 0%,#95c57f 100%)">
<div class="metric-label" data-i18n="peace">Peace Events</div>
<div class="metric-value" id="metric-peace">...</div>
<div class="metric-change" id="peace-trend">Loading...</div>
</div>
</div>

<div class="card">
<div class="card-header">
<h2 class="card-title">
<span>üìä</span>
<span data-i18n="peace-indicator">Global Peace Indicator</span>
</h2>
<span id="last-updated" style="font-size:0.75rem;color:var(--text-tertiary)">Updated: ...</span>
</div>
<div class="peace-needle-gauge">
<div class="needle-container">
<div class="needle-scale"></div>
<div class="needle-pointer" id="peace-needle" style="background:var(--warning)"></div>
<div class="needle-center"></div>
</div>
<div class="needle-labels">
<span class="needle-label collapse" data-i18n="collapse">COLLAPSE</span>
<span class="needle-label peace" data-i18n="peace-label">PEACE</span>
</div>
<div class="needle-score" id="peace-score">0</div>
</div>
</div>

<div class="card">
<div class="card-header">
<h2 class="card-title">
<span>üì∞</span>
<span data-i18n="live-events">Live Conflict & Peace Events</span>
</h2>
</div>
<div id="connection-alert"></div>
<div class="feed-container" id="live-feed"></div>
</div>

<div class="card">
<div class="card-header">
<h2 class="card-title">
<span>üö®</span>
<span data-i18n="humanitarian-alerts">Humanitarian Alerts</span>
</h2>
</div>
<div class="feed-container" id="humanitarian-feed"></div>
</div>
</main>

<div class="chat-widget" id="chat-widget">
<button class="chat-toggle" id="chat-toggle" aria-label="Open AI Assistant">ü§ñ</button>
<div class="chat-container" id="chat-container">
<div class="chat-header">
<span data-i18n="ai-assistant">Peace AI Assistant</span>
<button class="chat-close" id="chat-close">√ó</button>
</div>
<div class="chat-messages" id="chat-messages">
<div class="chat-message bot" data-i18n="welcome-msg">Hello! I can help you navigate the dashboard, analyze peace indicators, or answer questions about conflict data. Try asking: "Show me conflict hotspots" or "What's the peace trend?"</div>
</div>
<div class="chat-input-container">
<input type="text" class="chat-input" id="chat-input" placeholder="Ask me anything..." data-i18n-placeholder="ask-anything">
<button class="chat-send" id="chat-send">
<span data-i18n="send">Send</span>
</button>
</div>
</div>
</div>

<script>
"use strict";
const canvas=document.getElementById('galaxy-canvas'),ctx=canvas.getContext('2d');
canvas.width=window.innerWidth;canvas.height=window.innerHeight;
const stars=[],constellations=[];
class Star{constructor(){this.x=Math.random()*canvas.width;this.y=Math.random()*canvas.height;this.size=Math.random()*2;this.brightness=Math.random();this.twinkleSpeed=Math.random()*0.02;this.vx=(Math.random()-0.5)*0.1;this.vy=(Math.random()-0.5)*0.1}
update(){this.brightness+=this.twinkleSpeed;if(this.brightness>1||this.brightness<0)this.twinkleSpeed*=-1;this.x+=this.vx;this.y+=this.vy;if(this.x<0)this.x=canvas.width;if(this.x>canvas.width)this.x=0;if(this.y<0)this.y=canvas.height;if(this.y>canvas.height)this.y=0}
draw(){ctx.fillStyle=`rgba(127,176,105,${this.brightness})`;ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fill()}}
class Constellation{constructor(points){this.points=points}draw(){ctx.strokeStyle='rgba(127,176,105,0.2)';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(stars[this.points[0]].x,stars[this.points[0]].y);for(let i=1;i<this.points.length;i++){ctx.lineTo(stars[this.points[i]].x,stars[this.points[i]].y)}ctx.stroke()}}
for(let i=0;i<200;i++)stars.push(new Star());
for(let i=0;i<8;i++){const points=[];const numPoints=Math.floor(Math.random()*3)+3;for(let j=0;j<numPoints;j++){points.push(Math.floor(Math.random()*200))}constellations.push(new Constellation(points))}
function animateGalaxy(){ctx.clearRect(0,0,canvas.width,canvas.height);constellations.forEach(c=>c.draw());stars.forEach(s=>{s.update();s.draw()});requestAnimationFrame(animateGalaxy)}
animateGalaxy();
window.addEventListener('resize',()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight});

const AppState={online:navigator.onLine,language:'en',lastUpdate:null,conflictData:[],humanitarianData:[],peaceScore:0,metrics:{conflicts:0,humanitarian:0,displaced:0,peace:0}};

const Translations={en:{refresh:'Refresh',conflicts:'Active Conflicts',humanitarian:'Humanitarian Ops',displaced:'Displacement Events',peace:'Peace Events','peace-indicator':'Global Peace Indicator',collapse:'COLLAPSE','peace-label':'PEACE','live-events':'Live Conflict & Peace Events','humanitarian-alerts':'Humanitarian Alerts','ai-assistant':'Peace AI Assistant','welcome-msg':'Hello! I can help you navigate the dashboard, analyze peace indicators, or answer questions about conflict data. Try asking: "Show me conflict hotspots" or "What\'s the peace trend?"','ask-anything':'Ask me anything...',send:'Send'},es:{refresh:'Actualizar',conflicts:'Conflictos Activos',humanitarian:'Ops Humanitarias',displaced:'Desplazamientos',peace:'Eventos de Paz','peace-indicator':'Indicador de Paz Global',collapse:'COLAPSO','peace-label':'PAZ','live-events':'Eventos de Conflicto y Paz en Vivo','humanitarian-alerts':'Alertas Humanitarias','ai-assistant':'Asistente IA de Paz','welcome-msg':'¬°Hola! Puedo ayudarte a navegar el panel, analizar indicadores de paz o responder preguntas sobre datos de conflictos.','ask-anything':'Preg√∫ntame lo que sea...',send:'Enviar'},fr:{refresh:'Actualiser',conflicts:'Conflits Actifs',humanitarian:'Ops Humanitaires',displaced:'D√©placements',peace:'√âv√©nements de Paix','peace-indicator':'Indicateur de Paix Mondial',collapse:'EFFONDREMENT','peace-label':'PAIX','live-events':'√âv√©nements de Conflit et de Paix en Direct','humanitarian-alerts':'Alertes Humanitaires','ai-assistant':'Assistant IA de Paix','welcome-msg':'Bonjour! Je peux vous aider √† naviguer dans le tableau de bord, analyser les indicateurs de paix ou r√©pondre aux questions sur les donn√©es de conflit.','ask-anything':'Demandez-moi n\'importe quoi...',send:'Envoyer'}};

const DataService={async fetchGDELT(){try{const response=await fetch('https://api.gdeltproject.org/api/v2/doc/doc?query=conflict%20OR%20peace%20OR%20ceasefire%20OR%20humanitarian&mode=ArtList&maxrecords=20&format=json');if(!response.ok)throw new Error('GDELT offline');const data=await response.json();return data.articles||[]}catch(e){console.warn('GDELT unavailable:',e);return this.getMockGDELT()}},
getMockGDELT(){return[{title:'Peace talks scheduled in conflict region',url:'#',seendate:'20251006',domain:'un.org',tone:-2.5},{title:'Humanitarian corridor established for civilians',url:'#',seendate:'20251006',domain:'icrc.org',tone:5.2},{title:'Ceasefire violations reported in monitored zone',url:'#',seendate:'20251006',domain:'osce.org',tone:-4.8},{title:'Aid delivery reaches isolated communities',url:'#',seendate:'20251005',domain:'wfp.org',tone:3.7},{title:'Diplomatic negotiations show positive progress',url:'#',seendate:'20251005',domain:'un.org',tone:4.1}]},
async fetchACLED(){try{const response=await fetch('https://api.acleddata.com/acled/read?limit=20&terms=accept');if(!response.ok)throw new Error('ACLED offline');const data=await response.json();return data.data||[]}catch(e){console.warn('ACLED unavailable:',e);return this.getMockACLED()}},
getMockACLED(){return[{event_date:'2025-10-06',event_type:'Violence against civilians',fatalities:12,country:'Region A',notes:'Armed group attacked village'},{event_date:'2025-10-06',event_type:'Peaceful protest',fatalities:0,country:'Region B',notes:'Citizens demand peace negotiations'},{event_date:'2025-10-05',event_type:'Battle',fatalities:28,country:'Region C',notes:'Fighting between armed factions'},{event_date:'2025-10-05',event_type:'Agreement',fatalities:0,country:'Region D',notes:'Local ceasefire agreement signed'}]},
async fetchReliefWeb(){try{const response=await fetch('https://api.reliefweb.int/v1/reports?appname=peacedash&limit=15&preset=latest&profile=list&query[value]=crisis');if(!response.ok)throw new Error('ReliefWeb offline');const data=await response.json();return data.data||[]}catch(e){console.warn('ReliefWeb unavailable:',e);return this.getMockReliefWeb()}},
getMockReliefWeb(){return[{fields:{title:'Emergency food assistance reaches 50,000 people',date:{created:'2025-10-06T10:00:00+00:00'},source:[{name:'WFP'}],url:'#'}},{fields:{title:'Medical supplies delivered to conflict-affected areas',date:{created:'2025-10-06T08:30:00+00:00'},source:[{name:'WHO'}],url:'#'}},{fields:{title:'Displacement crisis worsens in border regions',date:{created:'2025-10-05T16:00:00+00:00'},source:[{name:'UNHCR'}],url:'#'}}]}};

const PeaceAnalyzer={peaceKeywords:['peace','ceasefire','dialogue','reconciliation','cooperation','humanitarian','aid','treaty','agreement','resolution','diplomacy','mediation','stability','development','collaboration','understanding','compromise'],collapseKeywords:['war','conflict','violence','attack','escalation','crisis','bombing','casualties','invasion','destruction','threat','weapons','militant','extremist','terror','blockade','siege','displacement','fighting','battle'],
analyzeSentiment(text){const lower=text.toLowerCase();let peaceScore=0;let collapseScore=0;this.peaceKeywords.forEach(kw=>{const count=(lower.match(new RegExp(kw,'g'))||[]).length;peaceScore+=count*2});this.collapseKeywords.forEach(kw=>{const count=(lower.match(new RegExp(kw,'g'))||[]).length;collapseScore+=count*2});const total=peaceScore+collapseScore||1;const peacePct=(peaceScore/total)*100;const collapsePct=(collapseScore/total)*100;const netScore=peacePct-collapsePct;return{peaceScore:Math.round(peacePct),collapseScore:Math.round(collapsePct),netScore:Math.round(netScore),sentiment:netScore>20?'peace':netScore<-20?'collapse':'neutral'}},
analyzeMultiple(items){const analyses=items.map(item=>({...item,analysis:this.analyzeSentiment((item.title||item.fields?.title||'')+' '+(item.notes||item.description||''))}));const avgNet=analyses.reduce((sum,a)=>sum+a.analysis.netScore,0)/(analyses.length||1);return{items:analyses,overallScore:Math.round(avgNet),overallSentiment:avgNet>20?'peace':avgNet<-20?'collapse':'neutral'}}};

async function loadAllData(){updateConnectionStatus();if(AppState.online){try{const[gdelt,acled,relief]=await Promise.all([DataService.fetchGDELT(),DataService.fetchACLED(),DataService.fetchReliefWeb()]);AppState.conflictData=acled;AppState.humanitarianData=relief;const combined=[...gdelt.slice(0,10),...acled.map(a=>({title:`${a.event_type} in ${a.country}`,description:a.notes,date:a.event_date,fatalities:a.fatalities}))];const analysis=PeaceAnalyzer.analyzeMultiple(combined);AppState.peaceScore=analysis.overallScore;AppState.metrics={conflicts:acled.filter(a=>a.event_type.includes('Battle')||a.event_type.includes('Violence')).length,humanitarian:relief.length,displaced:acled.filter(a=>a.notes?.toLowerCase().includes('displace')).length,peace:acled.filter(a=>a.event_type.includes('Agreement')||a.event_type.includes('Protest')).length};updateMetrics();updatePeaceNeedle(analysis.overallScore);renderLiveFeed(combined.slice(0,8));renderHumanitarianFeed(relief.slice(0,6));AppState.lastUpdate=new Date();document.getElementById('last-updated').textContent=`Updated: ${AppState.lastUpdate.toLocaleTimeString()}`;await cacheData({gdelt,acled,relief,analysis})}catch(e){console.error('Data fetch error:',e);showAlert('Using cached data - limited connectivity','warning');loadCachedData()}}else{showAlert('Offline mode - showing cached data','info');loadCachedData()}}

function updateMetrics(){document.getElementById('metric-conflicts').textContent=AppState.metrics.conflicts;document.getElementById('metric-humanitarian').textContent=AppState.metrics.humanitarian;document.getElementById('metric-displaced').textContent=AppState.metrics.displaced;document.getElementById('metric-peace').textContent=AppState.metrics.peace;document.getElementById('conflict-trend').textContent=`${AppState.metrics.conflicts} active incidents`;document.getElementById('humanitarian-trend').textContent=`${AppState.metrics.humanitarian} operations`;document.getElementById('displaced-trend').textContent=`${AppState.metrics.displaced} reports`;document.getElementById('peace-trend').textContent=`${AppState.metrics.peace} positive events`}

function updatePeaceNeedle(score){const angle=((score+100)/200)*180-90;const color=score>20?'var(--success)':score<-20?'var(--danger)':'var(--warning)';const needle=document.getElementById('peace-needle');needle.style.transform=`translateX(-50%) rotate(${angle}deg)`;needle.style.background=color;document.getElementById('peace-score').textContent=(score>0?'+':'')+score;document.getElementById('peace-score').style.color=color}

function renderLiveFeed(items){const feed=document.getElementById('live-feed');feed.innerHTML=items.map(item=>`<div class="feed-item"><div class="feed-item-title">${escapeHtml(item.title)}</div><div style="font-size:0.875rem;color:var(--text-secondary);margin-top:0.5rem">${escapeHtml(item.description||item.notes||'No details available')}</div><div class="feed-item-meta">${item.date||item.seendate||'Recent'} ${item.fatalities?`¬∑ ${item.fatalities} casualties`:''}</div></div>`).join('')}

function renderHumanitarianFeed(items){const feed=document.getElementById('humanitarian-feed');feed.innerHTML=items.map(item=>`<div class="feed-item"><div class="feed-item-title">${escapeHtml(item.fields?.title||item.title||'Update')}</div><div class="feed-item-meta">${item.fields?.source?.[0]?.name||'Source unavailable'} ¬∑ ${item.fields?.date?.created?new Date(item.fields.date.created).toLocaleDateString():'Recent'}</div></div>`).join('')}

function showAlert(msg,type){const alert=document.getElementById('connection-alert');alert.innerHTML=`<div class="alert alert-${type}"><span>${type==='warning'?'‚ö†Ô∏è':type==='info'?'‚ÑπÔ∏è':'‚úì'}</span><div>${msg}</div></div>`;setTimeout(()=>alert.innerHTML='',5000)}

function escapeHtml(str){const div=document.createElement('div');div.textContent=str||'';return div.innerHTML}

function updateConnectionStatus(){AppState.online=navigator.onLine;const dot=document.getElementById('connection-status');const text=document.getElementById('connection-text');if(AppState.online){dot.classList.remove('status-offline');text.textContent='Online'}else{dot.classList.add('status-offline');text.textContent='Offline'}}

async function cacheData(data){if('caches'in window){const cache=await caches.open('peace-dashboard-v1');await cache.put('/data.json',new Response(JSON.stringify({data,timestamp:Date.now()})))}}

async function loadCachedData(){if('caches'in window){const cache=await caches.open('peace-dashboard-v1');const response=await cache.match('/data.json');if(response){const cached=await response.json();if(Date.now()-cached.timestamp<86400000){const{data}=cached;AppState.conflictData=data.acled||[];AppState.humanitarianData=data.relief||[];AppState.peaceScore=data.analysis?.overallScore||0;updatePeaceNeedle(AppState.peaceScore);renderLiveFeed([...data.gdelt||[],...data.acled||[]].slice(0,8));renderHumanitarianFeed(data.relief||[]);return}}}updateMetrics()}

const ChatBot={async processMessage(msg){const lower=msg.toLowerCase();if(lower.includes('conflict')||lower.includes('hotspot')){return`Current active conflicts: ${AppState.metrics.conflicts}. Main incidents involve armed confrontations and violence against civilians. Would you like details on a specific region?`}if(lower.includes('peace')||lower.includes('trend')){return`Peace score: ${AppState.peaceScore>0?'+':''}${AppState.peaceScore}. ${AppState.peaceScore>20?'Positive trend - peace initiatives showing progress.':AppState.peaceScore<-20?'Concerning trend - escalating conflicts detected.':'Mixed signals - monitor closely.'}`}if(lower.includes('humanitarian')||lower.includes('aid')){return`${AppState.metrics.humanitarian} humanitarian operations active. Recent deliveries include food assistance, medical supplies, and emergency relief. Latest update: ${AppState.lastUpdate?.toLocaleString()}`}if(lower.includes('data')||lower.includes('source')){return`Data sources: GDELT (global events), ACLED (conflict data), ReliefWeb (humanitarian). Updates every 5 minutes when online. ${AppState.online?'Currently online.':'Offline - using cached data.'}`}if(lower.includes('translate')||lower.includes('language')){return`Dashboard supports 10 languages. Use the language selector in the header. Current: ${AppState.language}`}if(lower.includes('help')){return`I can help with:\n‚Ä¢ "Show conflict hotspots"\n‚Ä¢ "What's the peace trend?"\n‚Ä¢ "Humanitarian operations status"\n‚Ä¢ "Data sources"\n‚Ä¢ "Translate dashboard"`}return`Analyzing: "${msg}". Peace score is ${AppState.peaceScore>0?'+':''}${AppState.peaceScore}. ${AppState.metrics.conflicts} conflicts, ${AppState.metrics.peace} peace events tracked. Ask me specific questions!`}};

document.getElementById('chat-toggle').addEventListener('click',()=>{document.getElementById('chat-container').classList.add('active')});
document.getElementById('chat-close').addEventListener('click',()=>{document.getElementById('chat-container').classList.remove('active')});
document.getElementById('chat-send').addEventListener('click',sendMessage);
document.getElementById('chat-input').addEventListener('keypress',e=>{if(e.key==='Enter')sendMessage()});

async function sendMessage(){const input=document.getElementById('chat-input');const msg=input.value.trim();if(!msg)return;addChatMessage(msg,'user');input.value='';const loading=addChatMessage('...','bot');const response=await ChatBot.processMessage(msg);loading.remove();addChatMessage(response,'bot')}

function addChatMessage(text,type){const container=document.getElementById('chat-messages');const msg=document.createElement('div');msg.className=`chat-message ${type}`;msg.textContent=text;container.appendChild(msg);container.scrollTop=container.scrollHeight;return msg}

document.getElementById('lang-select').addEventListener('change',e=>{AppState.language=e.target.value;translatePage(e.target.value)});

function translatePage(lang){const trans=Translations[lang]||Translations.en;document.querySelectorAll('[data-i18n]').forEach(el=>{const key=el.dataset.i18n;if(trans[key])el.textContent=trans[key]});document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{const key=el.dataset.i18nPlaceholder;if(trans[key])el.placeholder=trans[key]})}

document.getElementById('refresh-all').addEventListener('click',loadAllData);

window.addEventListener('online',()=>{updateConnectionStatus();loadAllData();showAlert('Connection restored - fetching latest data','success')});
window.addEventListener('offline',()=>{updateConnectionStatus();showAlert('Connection lost - switching to offline mode','warning')});

if('serviceWorker'in navigator){const swCode=`self.addEventListener('install',()=>self.skipWaiting());self.addEventListener('activate',e=>e.waitUntil(clients.claim()));self.addEventListener('fetch',e=>{if(e.request.url.includes('api')){e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).then(res=>{const clone=res.clone();caches.open('peace-dashboard-v1').then(cache=>cache.put(e.request,clone));return res}).catch(()=>caches.match(e.request))))}});`;const blob=new Blob([swCode],{type:'application/javascript'});const swUrl=URL.createObjectURL(blob);navigator.serviceWorker.register(swUrl).catch(()=>{})}

loadAllData();
setInterval(()=>{if(AppState.online)loadAllData()},300000);

console.log('üåç Peace Dashboard loaded - monitoring global peace indicators');
</script>

<!-- Zero-Harm Notice -->
<!--
This tool is designed for peace-building and humanitarian coordination only.
Prohibited: Surveillance, weapons targeting, harm to individuals or communities.
License: MIT | Intended Use: Regenerative, restorative applications only
-->

</body>
</html>